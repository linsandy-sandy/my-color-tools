<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataColor Pro - çµ‚æ¥µè‰²å½©å·¥ä½œç«™</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Color Thief (ç”¨æ–¼åœ–ç‰‡å¸è‰²) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    
    <!-- å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; transition: background 0.3s; }
        /* è‡ªå®šç¾©é¸è‰²å™¨æ¨£å¼ */
        input[type="color"] {
            -webkit-appearance: none; border: none; width: 40px; height: 40px;
            border-radius: 50%; padding: 0; overflow: hidden; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 50%; border: 2px solid white; }
        
        .preview-active { transform: scale(1.02); border-color: #3b82f6; ring: 2px solid #93c5fd; }
        
        /* ç”œç”œåœˆåœ– */
        .chart-donut {
            width: 160px; height: 160px; border-radius: 50%;
            transition: background 0.5s ease; position: relative;
        }
        .chart-donut::after {
            content: ''; position: absolute; inset: 35px;
            background: inherit; border-radius: 50%; z-index: 1;
        }
        
        .filter-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
        
        /* è¼‰å…¥å‹•ç•« */
        #loading-overlay {
            position: fixed; inset: 0; background: white; z-index: 200;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col transition-colors duration-300">

    <!-- è¼‰å…¥ç•«é¢ -->
    <div id="loading-overlay">
        <div class="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-slate-500 font-medium">æ­£åœ¨æ ¡æ­£è‰²å½©æ•¸æ“š...</p>
    </div>

    <!-- å°è¦½åˆ— -->
    <nav class="bg-white/80 backdrop-blur-md shadow-sm border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg">D</div>
                <div>
                    <h1 class="text-lg font-bold tracking-tight leading-none">DataColor Pro</h1>
                    <span class="text-[10px] font-bold text-white bg-gradient-to-r from-blue-500 to-purple-500 px-2 py-0.5 rounded-full">v7.5 Precision</span>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="exportPaletteModal()" class="flex items-center gap-2 bg-slate-900 hover:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-lg hover:shadow-xl">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    <span>åŒ¯å‡º</span>
                </button>
                <a href="index.html" class="text-sm text-slate-500 hover:text-blue-600 px-2">å›é¦–é </a>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 py-8 flex-grow w-full">
        
        <!-- ä¸ŠåŠéƒ¨ï¼šå·¥ä½œå° (Workbench) -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
            
            <!-- å·¦å´ï¼šåœ–è¡¨é è¦½ (ä½” 7 ä»½) -->
            <div class="lg:col-span-7 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full transition-colors duration-300" id="preview-panel">
                <!-- å·¥å…·åˆ— -->
                <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                    <h2 class="font-bold text-slate-700 flex items-center gap-2">
                        <span class="text-xl">ğŸ“Š</span> å³æ™‚æ¨¡æ“¬
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="setChartType('bar')" id="btn-bar" class="p-2 rounded bg-white shadow-sm hover:text-blue-600"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M4 9h4v11H4zM10 4h4v16h-4zM16 14h4v6h-4z"/></svg></button>
                        <button onclick="setChartType('donut')" id="btn-donut" class="p-2 rounded text-slate-400 hover:bg-white hover:shadow-sm"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17.93c-2.48-.37-4.5-2.29-5-4.93h2c.46 1.54 1.7 2.72 3 3V19.93zM13 4.07V6c-1.3.28-2.54 1.46-3 3H8c.5-2.64 2.52-4.56 5-4.93zM4.07 13H6c.37 2.25 2.05 4.09 4.3 4.67v2.03C7.23 19.16 4.6 16.39 4.07 13zm1.6-4H4.07C4.6 6.39 7.23 3.62 10.3 3.3v2.03C8.05 5.91 6.37 7.75 6 10z"/></svg></button>
                        <div class="w-px h-6 bg-slate-300 mx-1"></div>
                        <button onclick="toggleTheme('light')" class="p-2 text-amber-500 hover:bg-amber-50 rounded"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg></button>
                        <button onclick="toggleTheme('dark')" class="p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg></button>
                    </div>
                </div>

                <!-- ç•«å¸ƒå€ -->
                <div class="flex-grow p-8 flex items-center justify-center relative" id="chart-container">
                    <!-- æŸ±ç‹€åœ– -->
                    <div id="chart-bar" class="w-full h-64 flex items-end justify-around px-4 border-b border-l border-slate-300/30"></div>
                    <!-- ç”œç”œåœˆåœ– -->
                    <div id="chart-donut" class="hidden chart-donut shadow-2xl flex items-center justify-center">
                        <div id="donut-center" class="absolute z-10 w-20 h-20 rounded-full flex items-center justify-center text-xs font-bold shadow-inner transition-colors duration-300">DATA</div>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šèª¿è‰²ç›¤æ§åˆ¶å° (ä½” 5 ä»½) -->
            <div class="lg:col-span-5 flex flex-col gap-6">
                
                <!-- 1. å‰µä½œè€…å·¥å…· (Creator) -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2">
                        <span class="text-blue-500">ğŸ¨</span> è‡ªå®šç¾©èª¿è‰² (Click to Edit)
                    </h3>
                    <div class="flex justify-between items-center mb-6" id="custom-pickers">
                        <!-- JS ç”Ÿæˆ 5 å€‹ Input Color -->
                    </div>
                    
                    <div class="border-t border-slate-100 pt-4">
                        <h3 class="font-bold text-slate-700 mb-3 flex items-center gap-2">
                            <span class="text-pink-500">ğŸ“¸</span> åœ–ç‰‡å¸è‰² (Image Magic)
                        </h3>
                        <div class="relative group">
                            <div class="border-2 border-dashed border-slate-300 rounded-xl p-4 text-center hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer" onclick="document.getElementById('imgInput').click()">
                                <p class="text-sm text-slate-500 group-hover:text-blue-600">é»æ“Šä¸Šå‚³åœ–ç‰‡æˆ–ç›´æ¥æ‹–æ›³è‡³æ­¤</p>
                                <p class="text-xs text-slate-400 mt-1">AI å°‡è‡ªå‹•å¿½ç•¥èƒŒæ™¯èˆ‡æ–‡å­—ï¼Œç²¾æº–æå– 5 è‰²</p>
                            </div>
                            <input type="file" id="imgInput" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
                        </div>
                        <!-- é è¦½ç¸®åœ– -->
                        <img id="preview-img" class="w-full h-32 object-contain rounded-lg mt-3 hidden shadow-md bg-slate-100" alt="Uploaded">
                    </div>
                </div>

            </div>
        </div>

        <!-- ä¸‹åŠéƒ¨ï¼šè‰²ç›¤è³‡æ–™åº« -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    ç²¾é¸è³‡æ–™åº« <span class="bg-slate-800 text-white text-xs px-3 py-1 rounded-full" id="count-badge">0</span>
                </h2>
                <!-- ç¯©é¸å™¨ -->
                <div class="flex flex-wrap gap-2" id="filter-container">
                    <button onclick="filterPalettes('All')" class="filter-btn active px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-blue-400 transition-all">All</button>
                    <button onclick="filterPalettes('Multi-Color')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-blue-400 transition-all text-purple-600 hover:text-purple-700 hover:border-purple-300 font-bold">ğŸŒˆ å¤šè‰²</button>
                    <button onclick="filterPalettes('Trending')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-indigo-400 text-indigo-600 transition-all">ğŸš€ å…¨çƒç†±é–€</button>
                    <button onclick="filterPalettes('Creative')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-pink-400 text-pink-600 transition-all">ğŸ¨ å‰µæ„ç²¾é¸</button>
                    <button onclick="filterPalettes('Business')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-blue-400 transition-all">ğŸ‘” å•†å‹™</button>
                    <button onclick="filterPalettes('Nature')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-green-400 transition-all">ğŸŒ¿ è‡ªç„¶</button>
                    <button onclick="filterPalettes('Dark Mode')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border bg-white hover:border-slate-400 transition-all">ğŸŒ™ æ·±è‰²</button>
                </div>
            </div>
            
            <div id="palette-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <!-- åŒ¯å‡º Modal -->
    <div id="exportModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[100] backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl transform transition-all scale-95 opacity-0" id="modalContent">
            <h3 class="text-xl font-bold mb-4 text-slate-800">åŒ¯å‡ºç›®å‰è‰²ç›¤</h3>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">JSON Array</label>
                    <div class="flex gap-2 mt-1">
                        <input type="text" id="export-json" class="w-full bg-slate-100 border-none rounded p-2 text-xs font-mono text-slate-600" readonly>
                        <button onclick="copyText('export-json')" class="bg-slate-200 hover:bg-slate-300 px-3 rounded text-xs font-bold text-slate-600">COPY</button>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase">CSS Variables</label>
                    <div class="flex gap-2 mt-1">
                        <textarea id="export-css" class="w-full bg-slate-100 border-none rounded p-2 text-xs font-mono text-slate-600 h-20 resize-none" readonly></textarea>
                        <button onclick="copyText('export-css')" class="bg-slate-200 hover:bg-slate-300 px-3 rounded text-xs font-bold text-slate-600">COPY</button>
                    </div>
                </div>
                <button onclick="downloadImage()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-bold shadow-lg hover:shadow-blue-500/30 transition-all flex justify-center items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    ä¸‹è¼‰ PNG è‰²å¡
                </button>
            </div>
            
            <button onclick="closeModal()" class="mt-6 w-full text-slate-400 text-sm hover:text-slate-600">é—œé–‰è¦–çª—</button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-all duration-300 pointer-events-none z-[200] flex items-center gap-2 transform translate-y-4">
        <span>âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</span>
    </div>

    <script>
        // --- æ ¸å¿ƒè®Šæ•¸ ---
        let currentColors = ["#2563eb", "#4f46e5", "#7c3aed", "#a855f7", "#d946ef"]; // é è¨­å€¼
        let currentChart = 'bar';
        let currentTheme = 'light';
        const colorThief = new ColorThief();

        // --- è³‡æ–™åº« (v7.5 PRECISION) ---
        const palettes = [
            // --- ğŸ“Œ æ‚¨çš„å®¢è£½åŒ–æ¼¸å±¤è‰²ç›¤ (Updated to precise hex) ---
            { name: "Forest to Gold", tag: "Nature", colors: ["#0b3d2e", "#145a32", "#1e7f43", "#4faf6e", "#9ed9b0", "#f1c854", "#e3b842", "#d4a72f", "#c6971d", "#b8860b"] },
            { name: "Verdant to Lemon", tag: "Nature", colors: ["#007f5f", "#2b9348", "#55a630", "#80b918", "#aacc00", "#bfd200", "#d4d700", "#dddf00", "#eeef20", "#ffff3f"] },

            // --- ğŸ“Œ æ‚¨ä¹‹å‰åŠ å…¥çš„è‰²ç›¤ ---
            { name: "Pastel Sweetheart", tag: "Creative", colors: ["#ffc4eb", "#ffe4fa", "#f1dedc", "#e1dabd", "#abc798"] },

            // --- ğŸŒˆ å¤šè‰²çµ„åˆ (Multi-Color 8-10 colors) ---
            { name: "Full Rainbow", tag: "Multi-Color", colors: ["#ffadad", "#ffd6a5", "#fdffb6", "#caffbf", "#9bf6ff", "#a0c4ff", "#bdb2ff", "#ffc6ff", "#fffffc"] },
            { name: "Spectral 10", tag: "Multi-Color", colors: ["#9e0142", "#d53e4f", "#f46d43", "#fdae61", "#fee08b", "#e6f598", "#abdda4", "#66c2a5", "#3288bd", "#5e4fa2"] },
            { name: "Tableau Classic", tag: "Multi-Color", colors: ["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"] },
            { name: "Vivid Spectrum", tag: "Multi-Color", colors: ["#001219", "#005f73", "#0a9396", "#94d2bd", "#e9d8a6", "#ee9b00", "#ca6702", "#bb3e03", "#ae2012", "#9b2226"] },
            { name: "Trend: Gradient 10", tag: "Multi-Color", colors: ["#03071e", "#370617", "#6a040f", "#9d0208", "#d00000", "#dc2f02", "#e85d04", "#f48c06", "#faa307", "#ffba08"] },
            { name: "Ocean Depth 10", tag: "Multi-Color", colors: ["#f7fcfd", "#e0ecf4", "#bfd3e6", "#9ebcda", "#8c96c6", "#8c6bb1", "#88419d", "#810f7c", "#4d004b", "#000000"] },
            { name: "Forest Life 8", tag: "Multi-Color", colors: ["#d8f3dc", "#b7e4c7", "#95d5b2", "#74c69d", "#52b788", "#40916c", "#2d6a4f", "#1b4332", "#081c15"] },
            { name: "Pastel Party 8", tag: "Multi-Color", colors: ["#ff99c8", "#fcf6bd", "#d0f4de", "#a9def9", "#e4c1f9", "#e2e2f0", "#ffadad", "#ffd6a5"] },
            { name: "Data Viz Safe", tag: "Multi-Color", colors: ["#88CCEE", "#CC6677", "#DDCC77", "#117733", "#332288", "#AA4499", "#44AA99", "#999933", "#882255", "#661100"] },
            { name: "Modern Dark UI", tag: "Multi-Color", colors: ["#16161a", "#242629", "#7f5af0", "#2cb67d", "#94a1b2", "#fffffe", "#ff8906", "#f25f4c", "#e53170", "#010101"] },

            // --- ğŸš€ å…¨çƒç†±é–€ (Trending) ---
            { name: "Trend: Ocean Blue", tag: "Trending", colors: ["#0077b6", "#0096c7", "#48cae4", "#90e0ef", "#caf0f8"] },
            { name: "Trend: Forest Hike", tag: "Trending", colors: ["#d8f3dc", "#b7e4c7", "#95d5b2", "#74c69d", "#52b788"] },
            { name: "Trend: Coffee Beans", tag: "Trending", colors: ["#6f4e37", "#a67b5b", "#ecb176", "#fed8b1", "#ffffdd"] },
            { name: "Trend: Berry Gradient", tag: "Trending", colors: ["#cdb4db", "#ffc8dd", "#ffafcc", "#bde0fe", "#a2d2ff"] },
            { name: "Trend: Sunset Gradient", tag: "Trending", colors: ["#ff99c8", "#fcf6bd", "#d0f4de", "#a9def9", "#e4c1f9"] },
            { name: "Trend: Seafoam", tag: "Trending", colors: ["#06d6a0", "#118ab2", "#073b4c", "#ffd166", "#ef476f"] },
            { name: "Trend: Warm & Cold", tag: "Trending", colors: ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"] },
            { name: "Trend: Neon Night", tag: "Trending", colors: ["#000000", "#14213d", "#fca311", "#e5e5e5", "#ffffff"] },
            { name: "Trend: Pastel Rainbow", tag: "Trending", colors: ["#ffadad", "#ffd6a5", "#fdffb6", "#caffbf", "#9bf6ff"] },
            { name: "Trend: Earthy Vibes", tag: "Trending", colors: ["#606c38", "#283618", "#fefae0", "#dda15e", "#bc6c25"] },
            { name: "Trend: Space Grey", tag: "Trending", colors: ["#343a40", "#495057", "#6c757d", "#adb5bd", "#ced4da"] },
            { name: "Trend: Vintage Film", tag: "Trending", colors: ["#cb997e", "#ddbea9", "#ffe8d6", "#b7b7a4", "#a5a58d"] },
            { name: "Trend: Deep Purple", tag: "Trending", colors: ["#10002b", "#240046", "#3c096c", "#5a189a", "#7b2cbf"] },
            { name: "Trend: Cherry Red", tag: "Trending", colors: ["#590d22", "#800f2f", "#a4133c", "#ff4d6d", "#ffb3c1"] },
            { name: "Trend: Bright Summer", tag: "Trending", colors: ["#f94144", "#f3722c", "#f8961e", "#f9844a", "#f9c74f"] },
            { name: "Trend: Cold Blue", tag: "Trending", colors: ["#03045e", "#0077b6", "#00b4d8", "#90e0ef", "#caf0f8"] },
            { name: "Trend: Minty Fresh", tag: "Trending", colors: ["#d9ed92", "#b5e48c", "#99d98c", "#76c893", "#52b69a"] },
            { name: "Trend: Lavender", tag: "Trending", colors: ["#e2e2f0", "#c6c6eb", "#7e7eb2", "#55557f", "#2b2b40"] },
            { name: "Trend: Dark Gold", tag: "Trending", colors: ["#ff0000", "#ff8700", "#ffd300", "#deff0a", "#a1ff0a"] }, 
            { name: "Trend: Clean UI", tag: "Trending", colors: ["#f8f9fa", "#e9ecef", "#dee2e6", "#ced4da", "#adb5bd"] },
            { name: "Trend: Rose Gold", tag: "Trending", colors: ["#d4a373", "#faedcd", "#fefae0", "#e9edc9", "#ccd5ae"] },
            { name: "Trend: Slate Blue", tag: "Trending", colors: ["#2d3142", "#4f5d75", "#bfc0c0", "#ffffff", "#ef8354"] },
            { name: "Trend: Vivid Purple", tag: "Trending", colors: ["#240046", "#3c096c", "#5a189a", "#7b2cbf", "#9d4edd"] },
            { name: "Trend: Coral Reef", tag: "Trending", colors: ["#f08080", "#f4978e", "#f8ad9d", "#fbc4ab", "#ffdab9"] },
            { name: "Trend: Midnight", tag: "Trending", colors: ["#0b132b", "#1c2541", "#3a506b", "#5bc0be", "#6fffe9"] },

             // 1. å•†å‹™èˆ‡ç§‘æŠ€ (Business)
            { name: "Tableau 10", tag: "Business", colors: ["#4e79a7", "#f28e2b", "#e15759", "#76b7b2", "#59a14f"] },
            { name: "Google Charts", tag: "Business", colors: ["#3366cc", "#dc3912", "#ff9900", "#109618", "#990099"] },
            { name: "PowerBI Default", tag: "Business", colors: ["#118DFF", "#12239E", "#E66C37", "#6B007B", "#E044A7"] },
            { name: "Tech Corporate", tag: "Business", colors: ["#2563eb", "#4f46e5", "#7c3aed", "#a855f7", "#d946ef"] },
            { name: "Professional Blue", tag: "Business", colors: ["#0f172a", "#1e293b", "#334155", "#475569", "#64748b"] },
            { name: "Deep Analytics", tag: "Business", colors: ["#1e3a8a", "#1d4ed8", "#2563eb", "#3b82f6", "#60a5fa"] },
            { name: "Finance Trust", tag: "Business", colors: ["#004e64", "#00a5cf", "#9fffcb", "#25a18e", "#7ae582"] },
            { name: "SaaS Dashboard", tag: "Business", colors: ["#3b82f6", "#6366f1", "#8b5cf6", "#a855f7", "#ec4899"] },
            { name: "Consulting Grey", tag: "Business", colors: ["#343a40", "#495057", "#6c757d", "#adb5bd", "#ced4da"] },
            { name: "Executive Gold", tag: "Business", colors: ["#14213d", "#fca311", "#e5e5e5", "#ffffff", "#000000"] },
            { name: "Modern Agency", tag: "Business", colors: ["#6c5ce7", "#a29bfe", "#ffeaa7", "#fab1a0", "#ff7675"] },
            
            // --- ğŸ¨ å‰µæ„ç²¾é¸ (Creative) ---
            { name: "Pop #7210 (Vibrant)", tag: "Creative", colors: ["#ff7473", "#ffc952", "#47b8e0", "#34314c"] },
            { name: "Pop #4714 (Teal/Purple)", tag: "Creative", colors: ["#9DC8C8", "#58C9B9", "#519D9E", "#D1B6E1"] },
            { name: "Pop #3598 (Blue/Orange)", tag: "Creative", colors: ["#e1eef6", "#ff5f2e", "#fcbe32", "#004e66"] },
            { name: "Pop #2877 (Primary)", tag: "Creative", colors: ["#30A9DE", "#EFDC05", "#E53A40", "#090707"] },
            { name: "Pop #2220 (Fresh Mint)", tag: "Creative", colors: ["#cff09e", "#a8dba8", "#79bd9a", "#3b8686"] },
            { name: "Pop #2209 (Warm)", tag: "Creative", colors: ["#FFEEE4", "#F17F42", "#CE6D39", "#000000"] },
            { name: "Pop #2110 (Pastel Pop)", tag: "Creative", colors: ["#a5dff9", "#ef5285", "#60c5ba", "#feee7d"] },
            { name: "Pop #2046 (Soft Purple)", tag: "Creative", colors: ["#A593E0", "#E0E3DA", "#FFFFF3", "#566270"] },
            { name: "Pop #1658 (Red/Teal)", tag: "Creative", colors: ["#E71D36", "#2EC4B6", "#EFFFE9", "#011627"] },
            { name: "Pop #1477 (Sunset)", tag: "Creative", colors: ["#F6B352", "#F68657", "#383A3F", `#1F2124`] },
            { name: "Pop #1373 (Pink/Blue)", tag: "Creative", colors: ["#e85a71", "#d8e9ef", "#4ea1d3", "#454552"] },
            { name: "Pop #1369 (Forest)", tag: "Creative", colors: ["#D7FFF1", "#8CD790", "#77AF9C", "#285943"] },
            { name: "Pop #1294 (Retro)", tag: "Creative", colors: ["#FBFFB9", "#FDD692", "#EC7357", "#754F44"] },
            { name: "Pop #1190 (Muted)", tag: "Creative", colors: ["#F0E5DE", "#ABD0CE", "#7C7877", "#D9D4CF"] },
            { name: "Pop #1070 (Deep Purple)", tag: "Creative", colors: ["#D499B9", "#9055A2", "#2E294E", "#011638"] },
            { name: "Pop #909 (Neon/Dark)", tag: "Creative", colors: ["#45d9fd", "#f4f4f4", "#ee2560", "#08182b"] },
            { name: "Pop #895 (Strong)", tag: "Creative", colors: ["#490a3d", "#bd1550", "#e97f02", "#f8ca00"] },
            { name: "Pop #889 (Cyber)", tag: "Creative", colors: ["#f9c00c", "#00b9f1", "#7200da", "#f9320c"] },
            { name: "Pop #703 (Soft Red)", tag: "Creative", colors: ["#d6ecfa", "#f15c5c", "#b84a39", "#6f3826"] },
            { name: "Pop #392 (Pink/Green)", tag: "Creative", colors: ["#fec9c9", "#ee6e9f", "#6d9d88", "#1a1a1a"] },

            // 2. æ¼¸å±¤èˆ‡ç†±åœ– (Sequential)
            { name: "Blues (Heatmap)", tag: "Sequential", colors: ["#eff3ff", "#bdd7e7", "#6baed6", "#3182bd", "#08519c"] },
            { name: "Greens (Growth)", tag: "Sequential", colors: ["#edf8e9", "#bae4b3", "#74c476", "#31a354", "#006d2c"] },
            { name: "Oranges (Intensity)", tag: "Sequential", colors: ["#feedde", "#fdbe85", "#fd8d3c", "#e6550d", "#a63603"] },
            { name: "Purples (Luxury)", tag: "Sequential", colors: ["#f2f0f7", "#cbc9e2", "#9e9ac8", "#756bb1", "#54278f"] },
            { name: "Grays (Neutral)", tag: "Sequential", colors: ["#f7f7f7", "#cccccc", "#969696", "#636363", "#252525"] },
            { name: "Reds (Alert)", tag: "Sequential", colors: ["#fee2e2", "#fca5a5", "#f87171", "#ef4444", "#b91c1c"] },
            { name: "Teals (Calm)", tag: "Sequential", colors: ["#ccfbf1", "#99f6e4", "#5eead4", "#2dd4bf", "#115e59"] },

            // 3. ç™¼æ•£èˆ‡å°æ¯” (Diverging)
            { name: "Red-Blue (Profit)", tag: "Diverging", colors: ["#b2182b", "#ef8a62", "#f7f7f7", "#67a9cf", "#2166ac"] },
            { name: "Purple-Green", tag: "Diverging", colors: ["#762a83", "#af8dc3", "#f7f7f7", "#7fbf7b", "#1b7837"] },
            { name: "Spectral (Map)", tag: "Diverging", colors: ["#d7191c", "#fdae61", "#ffffbf", "#abdda4", "#2b83ba"] },
            { name: "Br-Bg (Survey)", tag: "Diverging", colors: ["#a6611a", "#dfc27d", "#f5f5f5", "#80cdc1", "#018571"] },
            { name: "Pink-Lime", tag: "Diverging", colors: ["#e01e84", "#f48fb1", "#f7f7f7", "#b2df8a", "#33a02c"] },
            { name: "Orange-Purple", tag: "Diverging", colors: ["#e66101", "#fdb863", "#f7f7f7", "#b2abd2", "#5e3c99"] },

            // 4. è‡ªç„¶ç”Ÿæ…‹ (Nature)
            { name: "Forest Growth", tag: "Nature", colors: ["#064e3b", "#065f46", "#047857", "#10b981", "#34d399"] },
            { name: "Earth & Clay", tag: "Nature", colors: ["#7f5539", "#9c6644", "#b08968", "#ddb892", "#e6ccb2"] },
            { name: "Ocean Depth", tag: "Nature", colors: ["#03045e", "#0077b6", "#00b4d8", "#90e0ef", "#caf0f8"] },
            { name: "Tropical Vivid", tag: "Nature", colors: ["#0ea5e9", "#10b981", "#f59e0b", "#ef4444", "#ec4899"] },
            { name: "Sunset Horizon", tag: "Nature", colors: ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"] },
            { name: "Coffee House", tag: "Nature", colors: ["#6f4e37", "#a67b5b", "#ecb176", "#fed8b1", "#ffffdd"] },
            { name: "Cherry Blossom", tag: "Nature", colors: ["#590d22", "#800f2f", "#a4133c", "#ff4d6d", "#ffb3c1"] },
            { name: "Arctic Ice", tag: "Nature", colors: ["#0077b6", "#0096c7", "#48cae4", "#90e0ef", "#caf0f8"] },
            { name: "Desert Sand", tag: "Nature", colors: ["#bb3e03", "#ca6702", "#ee9b00", "#e9d8a6", "#94d2bd"] },

            // 5. ç„¡éšœç¤™ (Accessibility)
            { name: "Okabe-Ito (Safe)", tag: "Accessibility", colors: ["#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2"] },
            { name: "High Contrast", tag: "Accessibility", colors: ["#000000", "#FFFFFF", "#FFD700", "#0057E7", "#D62D20"] },
            { name: "Colorblind Vivid", tag: "Accessibility", colors: ["#EE7733", "#0077BB", "#33BBEE", "#EE3377", "#CC3311"] },
            
            // 6. æ·±è‰²æ¨¡å¼èˆ‡ç¾ä»£ (Dark Mode)
            { name: "Cyberpunk Neon", tag: "Dark Mode", colors: ["#f72585", "#7209b7", "#3a0ca3", "#4361ee", "#4cc9f0"] },
            { name: "Fintech Teal", tag: "Dark Mode", colors: ["#2d3436", "#00cec9", "#0984e3", "#6c5ce7", "#dfe6e9"] },
            { name: "Data Dark", tag: "Dark Mode", colors: ["#1e293b", "#334155", "#475569", "#94a3b8", "#cbd5e1"] },
            { name: "Neon Tokyo", tag: "Dark Mode", colors: ["#2c2c54", "#474787", "#aaabb8", "#ececec", "#ff5252"] },
            
            // 7. å¾©å¤èˆ‡æ‡·èˆŠ (Retro)
            { name: "Retro Synth", tag: "Retro", colors: ["#ff006e", "#8338ec", "#3a86ff", "#fb5607", "#ffbe0b"] },
            { name: "Vintage Paper", tag: "Retro", colors: ["#f4f1de", "#e07a5f", "#3d405b", "#81b29a", "#f2cc8f"] },
            { name: "Bauhaus", tag: "Retro", colors: ["#e63946", "#f1faee", "#a8dadc", "#457b9d", "#1d3557"] },
            { name: "Sepia Tone", tag: "Retro", colors: ["#7f5539", "#9c6644", "#b08968", "#ddb892", "#e6ccb2"] },

            // 8. å…¶ä»–/å ±å‘Š (Other)
            { name: "Nordic Pastel", tag: "Other", colors: ["#94a3b8", "#cbd5e1", "#e2e8f0", "#94a3b8", "#64748b"] },
            { name: "Minimalist", tag: "Other", colors: ["#212121", "#757575", "#BDBDBD", "#E0E0E0", "#F5F5F5"] },
            { name: "Macarons", tag: "Other", colors: ["#ff99c8", "#fcf6bd", "#d0f4de", "#a9def9", "#e4c1f9"] },
            { name: "Vibrant Sales", tag: "Other", colors: ["#ff595e", "#ffca3a", "#8ac926", "#1982c4", "#6a4c93"] },
            { name: "Corporate Blue", tag: "Other", colors: ["#003f5c", "#2f4b7c", "#665191", "#a05195", "#d45087"] },
            { name: "Warm Autumn", tag: "Other", colors: ["#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51"] },
            { name: "Cold Steel", tag: "Other", colors: ["#2b2d42", "#8d99ae", "#edf2f4", "#ef233c", "#d90429"] },
            { name: "Pop Art", tag: "Other", colors: ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ffffff"] }
        ];

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            renderPalettes(palettes);
            renderCustomPickers();
            updateAll();
            
            // é—œé–‰ Loading
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
            }, 800);
        };

        // --- æ ¸å¿ƒ 1: æ¸²æŸ“èˆ‡æ›´æ–° ---
        function updateAll() {
            renderPreview();
            updatePickers(); // è®“é¸è‰²å™¨åŒæ­¥ç›®å‰çš„é¡è‰²
        }

        function updateSelection(colors) {
            currentColors = [...colors]; // è¤‡è£½é™£åˆ—é¿å…åƒç…§å•é¡Œ
            updateAll();
        }

        // --- æ ¸å¿ƒ 2: åœ–è¡¨æ¨¡æ“¬ ---
        function renderPreview() {
            const chartBar = document.getElementById('chart-bar');
            const chartDonut = document.getElementById('chart-donut');
            const panel = document.getElementById('preview-panel');
            const donutCenter = document.getElementById('donut-center');

            // ä¸»é¡Œåˆ‡æ›
            if(currentTheme === 'dark') {
                panel.className = "lg:col-span-7 bg-slate-900 rounded-2xl shadow-sm border border-slate-700 overflow-hidden flex flex-col h-full transition-colors duration-300";
                donutCenter.style.backgroundColor = '#0f172a';
                donutCenter.style.color = 'white';
            } else {
                panel.className = "lg:col-span-7 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full transition-colors duration-300";
                donutCenter.style.backgroundColor = 'white';
                donutCenter.style.color = 'black';
            }

            // ç¹ªè£½æŸ±ç‹€åœ–
            if(currentChart === 'bar') {
                chartBar.classList.remove('hidden');
                chartDonut.classList.add('hidden');
                chartBar.innerHTML = '';
                // æ¨¡æ“¬æ•¸æ“š (æ“´å……è‡³ 8 ç­†ä»¥æ”¯æ´å¤šè‰²ç›¤)
                const data = [45, 70, 30, 90, 55, 65, 40, 80, 50, 60]; 
                
                // å‹•æ…‹ç”Ÿæˆè¶³å¤ æ•¸é‡çš„æŸ±å­
                const displayCount = Math.min(currentColors.length, data.length);
                
                for(let i=0; i<displayCount; i++) {
                    const color = currentColors[i];
                    const val = data[i];
                    const bar = document.createElement('div');
                    bar.style.height = `${val}%`;
                    bar.style.backgroundColor = color;
                    bar.className = "flex-1 mx-1 rounded-t-md hover:opacity-80 transition-all duration-500 ease-out";
                    chartBar.appendChild(bar);
                }
            } else {
                // ç¹ªè£½ç”œç”œåœˆåœ–
                chartBar.classList.add('hidden');
                chartDonut.classList.remove('hidden');
                let gradientStr = "";
                let startPct = 0;
                const segment = 100 / currentColors.length;
                currentColors.forEach(c => {
                    gradientStr += `${c} ${startPct}% ${startPct + segment}%,`;
                    startPct += segment;
                });
                chartDonut.style.background = `conic-gradient(${gradientStr.slice(0, -1)})`;
            }
        }

        // --- æ ¸å¿ƒ 3: è‡ªå®šç¾©é¸è‰²å™¨ (Custom Creator) ---
        function renderCustomPickers() {
            const container = document.getElementById('custom-pickers');
            container.innerHTML = '';
            
            // æ ¹æ“šç›®å‰é¡è‰²æ•¸é‡å‹•æ…‹ç”Ÿæˆé¸è‰²å™¨ (æœ€å°‘ 5 å€‹)
            const pickerCount = Math.max(5, currentColors.length);
            
            for(let i=0; i<pickerCount; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = "flex flex-col items-center gap-1";
                
                const input = document.createElement('input');
                input.type = 'color';
                input.id = `picker-${i}`;
                input.value = currentColors[i] || '#cccccc';
                
                // åªæœ‰ç•¶ index åœ¨ currentColors ç¯„åœå…§æ™‚æ‰å…è¨±ä¿®æ”¹
                if(i >= currentColors.length) {
                    input.disabled = true;
                    input.style.opacity = 0.3;
                }

                input.oninput = (e) => {
                    currentColors[i] = e.target.value;
                    renderPreview(); // å³æ™‚æ›´æ–°åœ–è¡¨
                };
                
                wrapper.appendChild(input);
                container.appendChild(wrapper);
            }
        }

        function updatePickers() {
            // é‡æ–°æ¸²æŸ“é¸è‰²å™¨ä»¥é©æ‡‰ä¸åŒæ•¸é‡çš„è‰²ç›¤
            renderCustomPickers();
        }

        // --- æ ¸å¿ƒ 4: åœ–ç‰‡å¸è‰² (è‡ªå®šç¾©ç®—æ³•) ---
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('preview-img');
                    img.src = e.target.result;
                    img.classList.remove('hidden');
                    
                    // ç­‰åœ–ç‰‡è¼‰å…¥å®Œæˆå¾Œå†è™•ç†
                    img.onload = () => {
                        try {
                            const extractedColors = extractColorsFromImage(img, 5);
                            currentColors = extractedColors;
                            updateAll(); 
                            showToast('ğŸ“¸ åˆ†æå®Œæˆï¼(å·²æ¿¾é™¤èƒŒæ™¯å¹²æ“¾)');
                        } catch (err) {
                            console.error(err);
                            showToast('âŒ åˆ†æå¤±æ•—ï¼Œè«‹æ›å¼µåœ–ç‰‡è©¦è©¦');
                        }
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // æ™ºæ…§å¸è‰²æ ¸å¿ƒé‚è¼¯
        function extractColorsFromImage(imgEl, colorCount) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ç¸®å°åœ–ç‰‡ä»¥åŠ å¿«è™•ç†é€Ÿåº¦
            const scale = Math.min(100 / imgEl.width, 100 / imgEl.height);
            canvas.width = imgEl.width * scale;
            canvas.height = imgEl.height * scale;
            
            ctx.drawImage(imgEl, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            
            const colorMap = new Map();
            
            // éæ­·åƒç´  (æ¯ 4 å€‹å–æ¨£ä¸€æ¬¡)
            for (let i = 0; i < imageData.length; i += 16) {
                const r = imageData[i];
                const g = imageData[i + 1];
                const b = imageData[i + 2];
                const a = imageData[i + 3];

                if (a < 125) continue; // å¿½ç•¥é€æ˜

                // éæ¿¾æ¥µç«¯ç™½è‰²/é»‘è‰² (èƒŒæ™¯å¹²æ“¾)
                // è¦å‰‡ï¼šRGB éƒ½å¤§æ–¼ 245 (ç™½) æˆ– éƒ½å°æ–¼ 20 (é»‘) å¿½ç•¥
                if (r > 245 && g > 245 && b > 245) continue;
                if (r < 20 && g < 20 && b < 20) continue;

                // é¡è‰²é‡åŒ– (Quantization) - å°‡ç›¸è¿‘é¡è‰²è¦–ç‚ºåŒä¸€ç¨®
                // é€™è£¡ç°¡å–®å°‡ RGB å€¼æ¨å…¥åˆ°æœ€è¿‘çš„ 10 çš„å€æ•¸
                const roundR = Math.round(r / 20) * 20;
                const roundG = Math.round(g / 20) * 20;
                const roundB = Math.round(b / 20) * 20;
                
                const key = `${roundR},${roundG},${roundB}`;
                colorMap.set(key, (colorMap.get(key) || 0) + 1);
            }

            // æ’åºï¼šå–å‡ºå‡ºç¾é »ç‡æœ€é«˜çš„é¡è‰²
            const sortedColors = [...colorMap.entries()]
                .sort((a, b) => b[1] - a[1])
                .slice(0, colorCount * 2); // å–å‰ 10 å€‹å€™é¸

            // è½‰å› Hex ä¸¦ç¢ºä¿é¸å‡ºçš„é¡è‰²æœ‰è¶³å¤ å·®ç•°
            const finalColors = [];
            
            for (const [key] of sortedColors) {
                if (finalColors.length >= colorCount) break;
                
                const [r, g, b] = key.split(',').map(Number);
                const hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
                
                // ç°¡å–®å·®ç•°æª¢æŸ¥ (é¿å…é¸åˆ°å¤ªåƒçš„é¡è‰²)
                let isDistinct = true;
                /* for (const existingHex of finalColors) {
                    // å¦‚æœéœ€è¦æ›´åš´æ ¼çš„æª¢æŸ¥å¯ä»¥åœ¨é€™è£¡åŠ 
                }
                */
                
                if (isDistinct) finalColors.push(hex);
            }
            
            // å¦‚æœé¡è‰²ä¸å¤ ï¼Œè£œä¸€äº›é è¨­è‰²
            while(finalColors.length < colorCount) {
                finalColors.push("#cccccc");
            }

            return finalColors;
        }

        // --- æ ¸å¿ƒ 5: è‰²ç›¤åˆ—è¡¨èˆ‡ç¯©é¸ ---
        function renderPalettes(list) {
            const grid = document.getElementById('palette-grid');
            document.getElementById('count-badge').innerText = list.length;
            grid.innerHTML = '';
            
            list.forEach(p => {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-xl shadow-sm border hover:border-blue-400 cursor-pointer transition-all hover:-translate-y-1";
                div.onclick = () => updateSelection(p.colors);
                
                let squares = '';
                p.colors.forEach(c => squares += `<div class="flex-1 h-12 first:rounded-l last:rounded-r" style="background:${c}"></div>`);
                
                // æ¨™ç±¤æ¨£å¼
                let tagClass = "bg-slate-100 text-slate-500";
                if(p.tag === "Multi-Color") tagClass = "bg-purple-100 text-purple-600";
                if(p.tag === "Trending") tagClass = "bg-indigo-100 text-indigo-600";
                if(p.tag === "Creative") tagClass = "bg-pink-100 text-pink-600";

                div.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <span class="font-bold text-slate-700 text-sm truncate pr-2" title="${p.name}">${p.name}</span>
                        <span class="text-[10px] ${tagClass} px-2 py-1 rounded whitespace-nowrap">${p.tag}</span>
                    </div>
                    <div class="flex">${squares}</div>
                `;
                grid.appendChild(div);
            });
        }

        function filterPalettes(tag) {
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.filter-btn').forEach(b => b.className = b.className.replace('active bg-blue-600 text-white', 'bg-white text-slate-600'));
            event.target.className += " active bg-blue-600 text-white"; // ç°¡å–®åˆ‡æ›
            
            if(tag === 'All') renderPalettes(palettes);
            else renderPalettes(palettes.filter(p => p.tag === tag || (tag === 'Trending' && p.tag.includes('Trend')) || (tag === 'Creative' && p.tag.includes('Creative'))));
        }

        // --- åŒ¯å‡ºåŠŸèƒ½ ---
        function exportPaletteModal() {
            document.getElementById('exportModal').style.display = 'flex';
            setTimeout(() => {
                const content = document.getElementById('modalContent');
                content.classList.remove('scale-95', 'opacity-0');
                content.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // å¡«å…¥è³‡æ–™
            document.getElementById('export-json').value = JSON.stringify(currentColors);
            document.getElementById('export-css').value = `:root {\n${currentColors.map((c, i) => `  --color-${i+1}: ${c};`).join('\n')}\n}`;
        }

        function closeModal() {
            const content = document.getElementById('modalContent');
            content.classList.remove('scale-100', 'opacity-100');
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => document.getElementById('exportModal').style.display = 'none', 300);
        }

        function copyText(id) {
            const el = document.getElementById(id);
            el.select();
            document.execCommand('copy');
            showToast('å·²è¤‡è£½ï¼');
        }

        function downloadImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 500;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');
            const w = 500 / currentColors.length;
            currentColors.forEach((c, i) => {
                ctx.fillStyle = c;
                ctx.fillRect(i * w, 0, w, 100);
            });
            const link = document.createElement('a');
            link.download = 'my-palette.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // --- å…¶ä»–å·¥å…· ---
        function setChartType(t) { currentChart = t; updateAll(); }
        function toggleTheme(t) { currentTheme = t; renderPreview(); }
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerHTML = `<span>${msg}</span>`;
            t.style.opacity = '1';
            t.style.transform = 'translate(-50%, 0)';
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translate(-50%, 16px)'; }, 2000);
        }

    </script>
</body>
</html>